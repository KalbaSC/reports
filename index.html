<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
    <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#000000">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>لوحة حضور المخيم الصيفي - نادي كلباء</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    @font-face {
      font-family: 'NotoKufiArabic';
      src: url('NotoKufiArabic.ttf') format('truetype');
    }
    body {
      font-family: 'NotoKufiArabic', sans-serif;
      background: url('black_and_yellow_grunge_background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: white;
      margin: 0;
      padding: 0;
    }
.header-container {
  width: 100%;
  background: #111;
  border-bottom: 2px solid #f4e733;
}
.header-right {
  width: 100%;
  max-width: 1170px;
  margin: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  padding: 20px 42px;
  background-color: #111;
  color: white;
  box-sizing: border-box;
}
.header-right img.logo {
  height: 70px;
}
.divider {
  width: 1.5px;
  height: 65px;
  background-color: #f4e733;
}
.header-info {
  text-align: center;
}
.arabic-name {
  font-weight: bold;
  font-size: 20px;
      font-weight: bold;
}
.english-name {
  font-size: 14px;
  color: #f4e733;
}
    .dropdown-content a:hover {
  background-color: #f4e733;
  color: black;
}
    .filter-btn {
  background-color: #111;
  color: #f4e733;
  border: 1px solid #f4e733;
  padding: 10px 18px;
  margin: 5px;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
}

.filter-btn.active {
  background-color: #f4e733;
  color: black;
}

    .container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      max-width: 1200px;
      margin: auto;
      padding: 20px;
      background: rgba(0, 0, 0, 0.9);
      border-radius: 10px;
      margin-top: 30px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      background: #222;
      padding: 15px;
      border-radius: 10px;
    }
    .controls input {
      padding: 10px;
      border-radius: 5px;
      margin: 5px;
    }
 .summary-box {
  display: flex;
  gap: 15px;
  align-items: center;
  color: #f4e733;
  font-weight: bold;
}    
.filter-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.search-group {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 10px;
  flex: 1;
}

.search-group select,
.search-group input,
.search-group button.clear-btn {
  height: 40px;
  padding: 8px 12px;
  font-size: 15px;
  border-radius: 6px;
  border: none;
  box-sizing: border-box;
  flex: 1;
  min-width: 140px;
}
.export-buttons {
  display: flex;
  flex-direction: row;
  gap: 10px;
}
    .controls .summary-box {
      display: flex;
      gap: 15px;
      align-items: center;
      color: #f4e733;
      font-weight: bold;
      margin: 5px;
    }
    button.export {
      background: #f4e733;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      margin: 5px;
      font-weight: bold;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #f4e733;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #333;
      color: #f4e733;
    }
nav {
  display: flex;
  justify-content: center; 
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  width: 100%;
  background-color: #111;
  border-bottom: 3px solid #f4e733;
  border-top: 1px solid #f4e733;
}
nav button,
.dropdown > button {
  font-size: 19px;
  padding: 13px 25px;
  margin: 0 15px;    
  border-radius: 8px;
  background-color: #111;
  color: #f4e733;
  border: none;
  text-align: center;     
  min-width: 100px;     
}
    .dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #222;
  min-width: 120px;
  z-index: 1;
  border: 1px solid #f4e733;
}

.dropdown-content a {
  color: #f4e733;
  padding: 10px 14px;
  display: block;
  text-align: right;
  cursor: pointer;
}

.dropdown:hover .dropdown-content {
  display: block;
}
nav button.active {
  background-color: #f4e733;
  color: black !important;
}
    .download-icon {
  display: inline-block;
  width: 18px;
  height: 18px;
  background: black;
  clip-path: polygon(50% 0%, 100% 50%, 75% 50%, 75% 100%, 25% 100%, 25% 50%, 0% 50%);
  margin-left: 5px;
  vertical-align: middle;
}
    .dropdown-content a.active {
  background-color: #f4e733;
  color: black !important;
}
    .filter-bar {
  max-width: 1200px;
  margin: auto;
}

    .hidden {
  display: none;
}
           footer {
      background-color: #111;
      color: white;
      text-align: center;
      padding: 20px;
      border-top: 3px solid #f4e733;
      font-size: 14px;
    }

    .social-icons a {
      color: white;
      margin: 0 8px;
      font-size: 20px;
    }
    #datePicker {
  background: white;
  color: black;
  border: none;
  padding: 10px;
  border-radius: 5px;
}
    @media (max-width: 768px) {
 .header-right {
    padding: 10px 10px;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 10px;
  }

  .header-info {
    display: block;
    text-align: center;
  }

  .header-info .arabic-name {
    font-size: 16px;
  }

  .header-info .english-name {
    font-size: 12px;
  }

  .header-right .divider {
    height: 45px;
    width: 1.5px;
    background-color: #f4e733;
  }

  img.logo {
    height: 50px !important;
    max-height: 50px !important;
  }
  nav {
    justify-content: center;
    margin: 0 auto;
    width: 100%;
    max-width: 100%;
  }

  nav button, .dropdown > button {
    flex: 1;
    text-align: center;
  }

  .title {
    font-size: 18px;
    margin-top: 15px;
    margin-bottom: 17px;
    line-height: 1.4;
  }
.controls {
  display: flex;
  flex-direction: column;
  align-items: center; 
  gap: 15px;
  background: #222;
  padding: 20px;
  border-radius: 10px;
  width: 100%;
  box-sizing: border-box;
}

.filter-bar {
  width: 100%;
  max-width: 600px;  
  margin: 0 auto;      
}

.search-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-sizing: border-box;
}

.search-group select,
.search-group input,
.search-group button,
#datePicker {
  width: 100%;
  padding: 10px;
  font-size: 14px;
  border-radius: 8px;
  border: none;
}

.clear-btn {
  background-color: #f4e733;
  color: black;
  font-weight: bold;
  border-radius: 8px;
  border: none;
  padding: 10px;
}

.export-buttons {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 10px;
}

.export-buttons .export {
  flex: 1;
  background-color: #f4e733;
  border: none;
  color: black;
  font-weight: bold;
  font-size: 14px;
  padding: 10px;
  border-radius: 8px;
}
      
  .summary-box {
    text-align: center;
    font-size: 14px;
  }
      
table {
  display: block;
  overflow-x: auto;
  font-size: 13px;
  width: 100%;
}
  th, td {
    padding: 6px;
  }

  canvas {
    width: 100% !important;
    height: auto !important;
  }
    
      .hidden {
  display: none;
}
  footer {
  text-align: center;
  padding: 15px 10px;
}

footer p {
  margin-bottom: 10px;
  font-size: 13px;
}
  .social-icons {
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
  }
  .social-icons a {
    font-size: 18px;
    padding: 8px;
  }
}
  </style>
</head>
<body>
  <header class="header-container">
  <div class="header-right">
    <img src="Picture3.png" alt="شعار مجلس الشارقة الرياضي" class="logo">
    <div class="divider"></div>
    <img src="logo.png" alt="شعار نادي كلباء الرياضي الثقافي" class="logo">
    <div class="header-info">
      <div class="arabic-name">نادي كلباء الرياضي الثقافي</div>
      <div class="english-name">KALBA SPORTS & CULTURAL CLUB</div>
    </div>
  </div>
</header>
  
<nav>
<button onclick="showView('general')">العام</button>
<button onclick="showView('stats')">الإحصائيات</button>
<button onclick="showView('activity')">الأنشطة</button>
<div id="dateFilters" style="margin-top: 10px; text-align: center;">
  <button onclick="filterData('day')" class="filter-btn">اليوم</button>
  <button onclick="filterData('week')" class="filter-btn">هذا الأسبوع</button>
  <button onclick="filterData('month')" class="filter-btn">هذا الشهر</button>
</div>

</nav>


<div class="container" id="generalView">
  <div class="title" style="color: #f4e733; text-align: center; font-weight: bold; font-size: 24px; margin-bottom: 25px;">
    حضور صيف الشارقة الرياضي - عطلتنا غير
  </div>

  <div class="controls">
    
<div class="filter-bar">
  <div class="search-group">
    <select onchange="showFilterOptions(this.value)">
      <option value="">🔍 بحث حسب...</option>
      <option value="name">الاسم</option>
      <option value="id">المعرّف</option>
      <option value="staff">الموظف</option>
      <option value="activity">النشاط</option>
    </select>

    <input id="filter-name" class="hidden" placeholder="أدخل الاسم..." onkeyup="filterTable()">
    <input id="filter-id" class="hidden" placeholder="أدخل المعرف..." onkeyup="filterTable()">
    <select id="filter-staff" class="hidden" onchange="filterTable()"></select>
    <select id="filter-activity" class="hidden" onchange="filterTable()"></select>

    <input type="date" id="datePicker" onchange="filterByDate()" />
    <button onclick="clearFilters()" class="clear-btn">مسح</button>
  </div>

  <div class="export-buttons">
    <button class="export" onclick="exportToExcel()">
      <span class="download-icon"></span> Excel
    </button>
    <button class="export" onclick="exportToPDF()">
      <span class="download-icon"></span> PDF
    </button>
  </div>
</div>

    <div class="summary-box">
      <span id="summary">إجمالي الحضور: 0</span>
      <span id="filteredSummary"></span>
    </div>
  </div>
    <table id="attendanceTable">
      <thead>
        <tr>
          <th>الوقت</th>
          <th>الاسم وولي الأمر</th>
          <th>المعرف</th>
          <th>الموظف</th>
          <th>النشاط</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  
  <div id="loading" style="text-align:center;color:#f4e733;">جاري التحميل...</div>

  <div id="todayStats" style="background:#222; padding:20px; border-radius:10px; margin-top:20px; color:#f4e733">
  <h3 style="margin-bottom:15px;">إحصاءات اليوم:</h3>
  <div id="staffToday"></div>
  <div id="timingToday" style="margin-top:10px;"></div>
</div>

</div>

<div class="container" id="activityView" style="display: none;">
  <div class="title" style="color: #f4e733; text-align: center; font-weight: bold; font-size: 24px; margin-bottom: 25px;">
    الحضور حسب الأنشطة
  </div>
  <table id="activityTable">
    <thead>
      <tr>
        <th>الوقت</th>
        <th>الاسم وولي الأمر</th>
        <th>المعرف</th>
        <th>الموظف</th>
        <th>النشاط</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
  
  <div class="container" id="statsView" style="display: none;">
    <h2 style="color:#f4e733; text-align:center">إحصائيات الحضور</h2>
    <canvas id="pieStaff" height="200"></canvas>
    <canvas id="earlyLate" height="200"></canvas>
    <canvas id="attendanceChart" height="200"></canvas>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxij6xIH_fypPRhklqQKURq-7xB5RJ3sC5dCBfwj4sJBjqnfXde1ncFrhCpDy04zuZW6g/exec';
    let allData = [], chart;
    let pieStaffChart = null, earlyLateChart = null;
    
function showView(view) {
  document.getElementById("generalView").style.display = "none";
  document.getElementById("statsView").style.display = "none";
  document.getElementById("activityView").style.display = "none";

  document.querySelectorAll("nav button").forEach(btn => btn.classList.remove("active"));

  if (view === 'general') {
    document.getElementById("generalView").style.display = "block";
    document.querySelector("nav button[onclick=\"showView('general')\"]").classList.add("active");
    filterData('day');
    renderGeneralTable(allData);
  } else if (view === 'stats') {
    document.getElementById("statsView").style.display = "block";
    document.querySelector("nav button[onclick=\"showView('stats')\"]").classList.add("active");
    showStats();
  } else if (view === 'activity') {
    document.getElementById("activityView").style.display = "block";
    document.querySelector("nav button[onclick=\"showView('activity')\"]").classList.add("active");
    renderActivityTable();
  }
}

function setActiveNav(type) {
  const filterButtons = document.querySelectorAll("#dateFilters .filter-btn");
  filterButtons.forEach(btn => btn.classList.remove("active"));

  const map = { day: 0, week: 1, month: 2 };
  if (map[type] !== undefined && filterButtons[map[type]]) {
    filterButtons[map[type]].classList.add("active");
  }
}

 document.querySelectorAll(".dropdown-content a").forEach(link => {
  link.addEventListener("click", () => {
    document.querySelectorAll(".dropdown-content a").forEach(el => el.classList.remove("active"));
    link.classList.add("active");
  });
});

window.onload = () => {
  fetchData().then(() => {
    showView('general');
   });
};

async function fetchData() {
  const response = await fetch(scriptURL);
  const rawData = await response.json();

  const seenIDs = new Set();
  allData = [];

  rawData.forEach(entry => {
    const id = entry["ID"];
    if (id && !seenIDs.has(id)) {
      seenIDs.add(id);
      allData.push(entry);
    }
  });

  renderGeneralTable(allData);
}

function filterData(type) {
  setActiveNav(type);
  document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
  if (type === 'day') document.querySelector('.filter-btn:nth-child(1)').classList.add('active');
  if (type === 'week') document.querySelector('.filter-btn:nth-child(2)').classList.add('active');
  if (type === 'month') document.querySelector('.filter-btn:nth-child(3)').classList.add('active');
}

function renderGeneralTable(data) {
  const tbody = document.querySelector("#attendanceTable tbody");
  tbody.innerHTML = "";

  data.forEach(entry => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${entry["Timestamp"] || ""}</td>
      <td>${entry["Child Name"] || ""} - ${entry["Parent"] || ""}</td>
      <td>${entry["ID"] || ""}</td>
      <td>${entry["Scanned By"] || ""}</td>
      <td>${entry["Activity"] || entry["General"] || ""}</td>
    `;
    tbody.appendChild(row);
  });

  document.getElementById("summary").textContent = `إجمالي الحضور: ${data.length}`;
}

function showStats() {
  console.log("showStats() called");
}

function renderActivityTable() {
  console.log("renderActivityTable() called");
}
  </script>
  <footer>
  <p>© 2025 نادي كلباء الرياضي الثقافي - جميع الحقوق محفوظة</p>
    <p style="font-size: 14px; color: #aaa; margin-top: -10px;">تم التطوير بواسطة روند أحمد الضمور</p>
  <div class="social-icons">
    <a href="https://facebook.com/Kalbasc1" target="_blank"><i class="fab fa-facebook-f"></i></a>
    <a href="https://instagram.com/kalbasc" target="_blank"><i class="fab fa-instagram"></i></a>
    <a href="https://x.com/Kalba_sc" target="_blank"><i class="fab fa-twitter"></i></a>
    <a href="https://youtube.com/@kalbasc" target="_blank"><i class="fab fa-youtube"></i></a>
    <a href="https://tiktok.com/@kalbasc" target="_blank"><i class="fab fa-tiktok"></i></a>
  </div>
</footer>
</body>
</html>
